<!DOCTYPE html>
<html lang="en">
<html>
  <head>
    <title>Projects</title>
    <link rel="stylesheet" href="../vendor/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="../css/projects.css">
    <script>
        var gui = require('nw.gui');
        var win = gui.Window.get();
        // win.showDevTools();
        var win_add;
    </script>
  </head>
  <body>
    <div class="main">
      <header>
          <div class="btn" id="add-project">
              <span class="fa fa-plus-square"></span> add
          </div>
      </header>
      <div id="projects-container">
      </div>
    </div>
    <script src="../vendor/jquery/dist/jquery.js"></script>
    <script src="../vendor/storedb/storedb.js"></script>
    <script>
        var projects = storedb('projects').find();
        var container = $("#projects-container");
        if(projects) {
            win.resizeTo(
                ((projects.length > 3) ? 180*3 : projects.length * 180),
                (200 + Math.floor((projects.length-1)/3) * 160)
            );
            projects.forEach(function(project) {
                container.append('<div class="project-container" id="'+project.name+'">'
                + '<div class="project-info"><img src="'+project.icon+'"><h2>'+project.name+'</h2></div>'
                + '<div class="project-options"></div></div>');
            });
        } else {
            win.resizeTo(180, 130);
            container.toggleClass("empty");
            container.append("<p>no projects</p>");
        }
        win.show();
        $("#add-project").on('click', function() {
            if(!win_add) {
                win_add = gui.Window.open('add-project.html',
                {
                    toolbar: false,
                    frame: false,
                    position: "center",
                    transparent: true,
                    width: 200,
                    height: 220,
                    focus: true,
                    resizable: false
                });
                win_add.on('add', function() {
                    win.reload();
                });
            }
            else {
                win_add.show();
            }
        });
    </script>
  </body>
</html>
